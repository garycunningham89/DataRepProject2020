<html>
<title>Trainers Inc. Training Record Storage</title>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
            integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<!-- Navbar (sit on top) -->
<div class="w3-center w3-black">
  <div class="w3-bar w3-black w3-wide w3-padding w3-card">
    <a href="#home" class="w3-bar-item w3-button"><b>Trainers</b> Inc.</a>
    <!-- Float links to the right. Hide them on small screens -->
    <div class="w3-right w3-hide-small">
      <a href= "#home" class="w3-bar-item w3-button"><i class="fa fa-graduation-cap"></i> Records</a>
      <a href="#about" class="w3-bar-item w3-button"><i class="fa fa-info"></i> About</a>
      <a href="#contact" class="w3-bar-item w3-button"><i class="fa fa-comment"></i> Contact</a>
    </div>
  </div>
</div>
<!-- Header -->
<header class="w3-display-container w3-content w3-wide" style="max-width:1500px;" id="home">
  <img class="w3-image" src="https://tse4.mm.bing.net/th?id=OIP.T69CmF44pQqc8X25_uEX7wHaD4&pid=Api&P=0&w=290&h=153" style="width:500px;">
  <div class="w3-display-middle w3-margin-top w3-center">
    <h1 class="w3-xxlarge w3-text-white"><span class="w3-padding w3-black w3-opacity-min"><b>Trainers</b></span> <span class="w3-hide-small w3-text-grey">Inc.</span></h1>
  </div>
</header>
<body>
    <div class="w3-center w3-padding-16" id="create-update" style="display:none">
        <h2 class="w3-border-bottom w3-border-light-grey w3-padding-16"><b>Add Training Record</b></h2>
        <table class= "table" id="createUpdateForm">
            <form action="">
            <tr>
                <td>ID</td>
                <td><input type="number" name="userid" required id="idInput" placeholder="Please Input ID"></td>
            </tr>
            <tr>
                <td>Full Name</td>
                <td><input type="text" name="name" required placeholder="Please Input Full Name" > </td>
            </tr>
            <tr>
                <td>Training Record</td>
                <td><input type="text" name="trainingrecord" required placeholder="Please Input Training Record Details"></td>
            </tr>
            <tr>    
                <td>Completion Date</td>
                <td><input type="number" name="yearcompleted" required placeholder="Please Input Year"></td>
            </tr>
            <tr>    
                <td>Expiration Date</td>
                <td><input type="number" name="expiryyear" required placeholder="Please Input Year"></td>
            </tr>
            <tr>
                <td></td><td>
                    <button class="w3-button w3-black w3-section"id="create-button" onclick="doCreate()"> <i class="fa fa-plus"></i> Save Changes</button>     
                    <button class="w3-button w3-black w3-section"id="update-button" onclick="doUpdate()"> <i class="fa fa-pencil"></i> Update Record</button>
                    <button class="w3-button w3-red w3-section"id="cancel-changes" onclick=""><a href= "/index.html"> <i class="fa fa-ban"></i> Cancel</button>
                </td>
            </tr>
            </form>
        </table>
    </div>
    <div class="w3-center w3-padding-16" id="display">
        <h2><b><i class="fa fa-graduation-cap"></i> Training Records</b></h2>
    <table id="trainingTable" class="table">
        <tr>
            <th>ID</th><th> Full Name</th><th>Training Record</th><th>Completion Date</th><th>Expiration Date</th><th>Update Details</th><th>Delete Record</th>
        </tr>
    </table>
    <button class="w3-button w3-black w3-section w3-center" onClick="showCreate()"> <b><i class="fa fa-plus"></i> Add New Record</b></button>
    </div>
<!-- About Section -->
<div class="w3-center w3-black w3-padding-16" id="about">
<h3 class="w3-border-bottom w3-border-light-grey w3-padding-16"><i class="fa fa-info"></i> <b>ABOUT</b></h3>
<p> This Webpage shows the training records table as part of the project for the Data Representation module in the Higher Diploma for Data Analysis course. 
</p>
</div>

  <!-- Contact Section -->
  <div class="w3-center w3-black w3-padding-16" id="contact">
    <h3 class="w3-border-bottom w3-border-light-grey w3-padding-16"><i class="fa fa-comment"> </i> <b>CONTACT US</b></h3>
    <p>Lets get in touch and talk about uploading all your training records.</p>
     <p><a href="/home" class="w3-hover-text-green">LOG IN HERE</a></p>
    <form action="/gmit.ie" target="_blank">
      <input class="w3-input w3-border" type="text" placeholder="Name" required name="Name">
      <input class="w3-input w3-section w3-border" type="text" placeholder="Email" required name="Email">
      <input class="w3-input w3-section w3-border" type="text" placeholder="Subject" required name="Subject">
      <input class="w3-input w3-section w3-border" type="text" placeholder="Comment" required name="Comment">
      <button class="w3-button w3-green w3-section" type="submit">
        <i class="fa fa-paper-plane"></i> SEND MESSAGE
      </button>
    </form>
  </div>
  
<!-- Image of location/map -->
<div class="w3-container w3-black">
  <img src="https://tse3.mm.bing.net/th?id=OIP.KKHeUJOX-qegTDdCRleyUgHaCx&pid=Api&P=0&w=459&h=173" class="w3-image" style="width:100%">
</div>

<!-- End page content -->


        <script>
            function showCreate(){
                document.getElementById('display').style.display = "none"
                document.getElementById('update-button').style.display = "none"
                document.getElementById('create-button').style.display = "block"
                document.getElementById('create-update').style.display = "block"

            }
            
            function showUpdate(thisElem){
                var rowElement = thisElem.parentNode.parentNode;
                training = readRecordFromRow(rowElement)
                populateForm(training)

                document.getElementById('display').style.display = "none"
                document.getElementById('update-button').style.display = "block"
                document.getElementById('create-button').style.display = "none"
                document.getElementById('create-update').style.display = "block"

            }
            
            function returnPage(){
            document.getElementById('update-button').style.display = "none"
            }
            function readRecordFromRow(rowElement){
                training = {}
                training.userid = rowElement.getAttribute("id");
                training.name = rowElement.cells[1].firstChild.textContent
                training.trainingrecord = rowElement.cells[2].firstChild.textContent
                training.yearcompleted = rowElement.cells[3].firstChild.textContent
                training.expiryyear = rowElement.cells[4].firstChild.textContent
                return training
                
            }
            function populateForm(training){
                var form = document.getElementById('createUpdateForm')

                form.querySelector('input[name="userid"]').value = training.userid
                form.querySelector('input[name="userid"]').disabled=true
                
                form.querySelector('input[name="name"]').value = training.name
                form.querySelector('input[name="trainingrecord"]').value = training.trainingrecord
                form.querySelector('input[name="yearcompleted"]').value = training.yearcompleted      
                form.querySelector('input[name="expiryyear"]').value = training.expiryyear      
            }
            function clearForm() {
                var form = document.getElementById('createUpdateForm')

                form.querySelector('input[name="userid"]').value = ''
                form.querySelector('input[name="userid"]').disabled=false
                
                form.querySelector('input[name="name"]').value = ''
                form.querySelector('input[name="trainingrecord"]').value = ''
                form.querySelector('input[name="yearcompleted"]').value = ''      
                form.querySelector('input[name="expiryyear"]').value = ''      
            }
            
            function doCreate(){
                console.log("in doCreate")
                training= getTrainingFromForm()
                console.log(training)
                $.ajax({
                    url:"/training",
                    data:JSON.stringify(training),
                    method:"POST",
                    dataType:"JSON",
                    contentType: "application/json; charset=utf-8",
                    success:function(result){
                        console.log(result) 
                        addTrainingToTable(training)
                        showDisplay()
                        clearForm()

                    },
                    error:function(xhr,status,error){
                        console.log("error"+error)
                    }
                })
               
            }
            function doUpdate(){
                training = getTrainingFromForm()
                updateServer(training)
                
            }
            function updateServer(training){
               $.ajax({
                    url: "/training/"+training.userid,
                    data: JSON.stringify(training),
                    method: "PUT",
                    dataType: "JSON",
                    contentType: "application/json; charset=utf-8",
                    success: function (result) {
                        console.log(result)
                        updateTableRow(training)
                        showDisplay()
                        clearForm()

                    },
                    error: function (xhr, status, error) {
                        console.log("error" + error)
                    }
                })
            }
            function deleteRow(thisElem){
                var tableElement = document.getElementById('trainingTable');
                var rowElement = thisElem.parentNode.parentNode;
                var index = rowElement.rowIndex;
                userid = rowElement.getAttribute("id");
                $.ajax({
                    url:"/training/"+userid,
                    method:"DELETE",
                    dateType:"JSON",
                    success:function(result){
                        tableElement.deleteRow(index);
                    },
                    error:function(xhr,status,error){
                        console.log(error)
                    }
                })
                
            }
            function updateTableRow(training){
                rowElement = document.getElementById(training.userid)
                rowElement.cells[1].firstChild.textContent = training.name
                
                rowElement.cells[2].firstChild.textContent = training.trainingrecord
                rowElement.cells[3].firstChild.textContent = training.yearcompleted
                rowElement.cells[4].firstChild.textContent = training.expiryyear
                //console.log("updating table")
            }
            function getTrainingFromForm(){
                var form = document.getElementById('createUpdateForm')

                var training = {}
                training.userid = form.querySelector('input[name="userid"]').value
                training.name = form.querySelector('input[name="name"]').value
                training.trainingrecord = form.querySelector('input[name="trainingrecord"]').value
                training.yearcompleted = form.querySelector('input[name="yearcompleted"]').value
                training.expiryyear = form.querySelector('input[name="expiryyear"]').value
                //console.log(training)
                 return training
            }
             function showDisplay() {
                    document.getElementById('display').style.display = "block"
                    document.getElementById('create-update').style.display = "none"

                }

            function populateTable(){
                //ajax getAll
               $.ajax({
                   url:'http://127.0.0.1:5000/training',
                   method:'GET',
                   datatype:'JSON',
                   success:function(results){
                        for (training of results){
                             addTrainingToTable(training)
                        }
                   },
                   error:function (xhr,status,error){
                       console.log ("error "+error +" code:"+status)
                   }

               })
               
            }
            function addTrainingToTable(training){
                //console.log("working so far")
                tableElem = document.getElementById("trainingTable")
                rowElem = tableElem.insertRow(-1)
                rowElem.setAttribute("id", training.userid)
                cell1 = rowElem.insertCell(0)
                cell1.innerHTML = training.userid
                cell2 = rowElem.insertCell(1)
                cell2.innerHTML = training.name
                cell3 = rowElem.insertCell(2)
                cell3.innerHTML = training.trainingrecord
                cell4 = rowElem.insertCell(3)
                cell4.innerHTML = training.yearcompleted
                cell5 = rowElem.insertCell(4)
                cell5.innerHTML = training.expiryyear
                cell6 = rowElem.insertCell(5)
                cell6.innerHTML = '<button class="w3-button w3-black" onclick="showUpdate(this)"><i class="fa fa-edit"></i></button>'
                cell7 = rowElem.insertCell(6)
                cell7.innerHTML = '<button class="w3-button w3-black" onclick="deleteRow(this)"><i class="fa fa-remove"></i></button>'
                 }
            populateTable()
</script>
</body>
<!-- Footer -->
<footer class="w3-center w3-black w3-padding-16">
  <p>Powered by <a href="https://gmit.ie" class="w3-hover-text-green">Data Representation Project</a></p>
</footer>

</html>